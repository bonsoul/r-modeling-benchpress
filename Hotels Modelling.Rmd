---
title: "Hotel Bookings"
author: "Bonsoul"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE,cache.lazy = FALSE, 
                      message = FALSE, cache = TRUE, dpi = 180,
                      fig.width = 8, fig.height = 5, fig.align = "center",
                      fig.pos = "H", out.width = "80%",
                      comments = NA)
```


```{r}
library(pacman)

```


```{r}
pacman::p_load(tidyverse, silgelib)

theme_set(theme_plex())
```

#build a model using recipes for Hotel Booking

# data https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/hotels.csv

```{r}

hotels <- readr:: read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-02-11/hotels.csv")
```

```{r}
skimr::skim(hotels)

```

```{r}
hotels %>%  count(is_canceled)
```

```{r}
hotels %>% select(children, babies) %>% sample_n(10)
```

```{r}
hotels %>%
  filter(is_canceled == 0) %>%
  mutate(children = case_when(children + babies > 0 - "children",
                              TRUE - "none"),
         required_car_parking_spaces = case_when(required_car_parking_spaces > 0 - "parking",
                                                 TRUE - "none")) %>%
  select(- is_canceled, -reservation_status, -babies)
hotel_stays

hotel_stays %>%
  count(children)
```

```{r}
hotel_stays <- hotels %>%
  filter(is_canceled == 0) %>%
  mutate(
    children = case_when(
      children + babies > 0 ~ "children",
      TRUE ~ "none"
    ),
    required_car_parking_spaces = case_when(
      required_car_parking_spaces > 0 ~ "parking",
      TRUE ~ "none"
    )
  ) %>%
  select(-is_canceled, -reservation_status, -babies)

```

```{r}
hotel_stays %>%
  mutate(arrival_date_month = factor(arrival_date_month,
                                     levels = month.name)) %>%
  count(hotel,arrival_date_month, children) %>%
  group_by(hotel, children) %>%
  mutate(proportion = n / sum(n)) %>%
  ggplot(aes(arrival_date_month, proportion, fill = children)) + 
  geom_col(position = "dodge") + 
  scale_y_continuous(labels = scales::percent_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(vars(hotel), nrow = 2)

```

```{r}
hotel_stays %>%
  count(hotel,required_car_parking_spaces, children) %>%
  group_by(hotel, children) %>%
  mutate(proportion = n / sum(n)) %>%
  ggplot(aes(required_car_parking_spaces, proportion, fill = children)) + 
  geom_col(position = "dodge") + 
  scale_y_continuous(labels = scales::percent_format()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  facet_wrap(vars(hotel), nrow = 2)
```


```{r}
hotel_stays %>%
  count(children)
```

```{r}
skim(hotel_stays)
```

```{r}
library(GGally)

hotel_stays %>%
  select(children, adr,
         required_car_parking_spaces,
         total_of_special_requests) %>%
  ggpairs(mapping = aes(color = children))

```

```{r}
hotel_df <- hotel_stays %>%
  select(children, hotel,arrival_date_day_of_month,meal, adr, adults,
         required_car_parking_spaces, total_of_special_requests,
         stays_in_week_nights, stays_in_week_nights) %>%
  mutate_if(is.character, factor)
```

```{r}
library(tidymodels)

set.seed(1234)
hotel_split <- initial_split(hotel_df)

hotel_train <- training(hotel_split)
hotel_test <- testing(hotel_split)

#recipe(children)
```


