---
title: "Northern Mapping"
author: "Bonsoul"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

```{r}
library(sf)

shp <- st_read("~/R Studio/R_Statistical-Language/Cholera_Analysis/shapefiles/County.shp")

```


```{r}
names(shp)
```

```{r}
plot(
  st_geometry(shp),
  col = "lightgrey",
  border = "black",
  main = "Counties of Kenya"
)

```

```{r}
library(sf)
library(ggplot2)

county_centroids <- st_point_on_surface(shp)


```

```{r}
ggplot() +
  geom_sf(data = shp, fill = "grey90", color = "white", linewidth = 0.2) +
  geom_sf_text(
    data = county_centroids,
    aes(label = Name),
    size = 2,
    color = "black"
  ) +
  labs(title = "Counties of Kenya") +
  theme_void()

```


```{r}
ggplot() +
  geom_sf(data = shp, fill = "grey90", color = "white", linewidth = 0.2) +
  geom_sf_text(
    data = county_centroids,
    aes(label = Name),
    size = 2,
    color = "black"
  ) +
  labs(title = "Counties of Kenya") +
  theme_void() +
  theme(
    plot.background  = element_rect(fill = "aliceblue", color = NA),
    panel.background = element_rect(fill = "aliceblue", color = NA)
  )

```


```{r}
ggplot() +
  geom_sf(data = shp, fill = "grey85", color = "white", linewidth = 0.2) +
  geom_sf_text(
    data = county_centroids,
    aes(label = Name),
    size = 2
  ) +
  labs(title = "Counties of Kenya") +
  theme_void() +
  theme(
    plot.background  = element_rect(fill = "ivory", color = NA),
    panel.background = element_rect(fill = "ivory", color = NA)
  )

```


```{r}
library(dplyr)

highlight_counties <- c("Marsabit", "Wajir", "Isiolo", "Mandera", "Garissa")

shp <- shp %>%
  mutate(
    highlight = ifelse(Name %in% highlight_counties,
                       "Highlighted", "Other")
  )

```


```{r}
ggplot() +
  geom_sf(
    data = shp,
    aes(fill = highlight),
    color = "white",
    linewidth = 0.2
  ) +
  geom_sf_text(
    data = county_centroids,
    aes(label = Name),
    size = 2,
    color = "black"
  ) +
  scale_fill_manual(
    values = c(
      "Highlighted" = "grey20",
      "Other" = "grey85"
    )
  ) +
  labs(
    title = "Highlighted Counties in Kenya",
    fill = ""
  ) +
  theme_void() +
  theme(
    plot.background  = element_rect(fill = "aliceblue", color = NA),
    panel.background = element_rect(fill = "aliceblue", color = NA)
  )

```

```{r}
library(dplyr)

highlight_counties <- c("Marsabit", "Wajir", "Isiolo", "Mandera", "Garissa")

shp <- shp %>%
  mutate(
    shade = ifelse(Name %in% highlight_counties,
                   "Dark", "Light")
  )

```

```{r}
ggplot() +
  geom_sf(
    data = shp,
    aes(fill = shade),
    color = "white",
    linewidth = 0.2
  ) +
  geom_sf_text(
    data = county_centroids,
    aes(label = Name),
    size = 2,
    color = "black"
  ) +
  scale_fill_manual(
    values = c(
      "Light" = "grey85",  # base color for most counties
      "Dark" = "grey60"    # slightly darker for the five counties
    )
  ) +
  labs(
    title = "Map Of Kenya Highlighting Nothern Counties",
    fill = ""
  ) +
  theme_void() +
  theme(
    plot.background  = element_rect(fill = "aliceblue", color = NA),
    panel.background = element_rect(fill = "aliceblue", color = NA)
  )

```


```{r}
library(dplyr)

dat5 <- dat3 %>%
  mutate(
    covid_period = case_when(
      Year < 2020 ~ "Pre-COVID",
      Year >= 2020 ~ "Post-COVID"
    )
  )

table(dat5$covid_period)

```


```{r}
reporting_covid <- dat5 %>%
  group_by(covid_period, County, `Health Facility`, Year, Month) %>%
  summarise(records = n(), .groups = "drop")

head(reporting_covid)

```

```{r}
gender_county_covid <- dat5 %>%
  filter(!is.na(Gender)) %>%
  mutate(
    covid_period = ifelse(Year < 2020, "Pre-COVID", "Post-COVID")
  ) %>%
  group_by(covid_period, County, Gender) %>%
  summarise(n = n(), .groups = "drop") %>%
  tidyr::pivot_wider(
    names_from = Gender,
    values_from = n,
    values_fill = 0
  ) %>%
  mutate(
    F_to_M_ratio = ifelse(Male == 0, NA, Female / Male)
  )


```

```{r}
gender_county_covid %>% flextable()
```


```{r}

gender_county_clean <- gender_county_covid %>%
  filter(
    !is.na(County),
    County != "",
    !(Female == 0 & Male == 1 & F_to_M_ratio == 0)
  )

```


```{r}
gender_county_clean <- gender_county_clean %>%
  group_by(County) %>%
  filter(n() == 2) %>%   # keeps counties with both periods
  ungroup()

```


```{r}
gender_county_presentable <- gender_county_clean %>%
  arrange(County, covid_period) %>%
  mutate(F_to_M_ratio = round(F_to_M_ratio, 2))

```


```{r}

gender_county_presentable %>% flextable()

```




```{r}
gender_change <- gender_county_presentable %>%
  tidyr::pivot_wider(
    names_from = covid_period,
    values_from = F_to_M_ratio
  ) %>%
  mutate(change = `Post-COVID` - `Pre-COVID`)

ggplot(gender_change,
       aes(x = reorder(County, change), y = change)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Change in Female-to-Male Ratio After COVID-19",
    x = "",
    y = "Post âˆ’ Pre Difference"
  ) +
  theme_minimal()

```

