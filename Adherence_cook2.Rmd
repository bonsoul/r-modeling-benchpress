---
title: "Adhere.Generated"
author: "Bonsoul"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
```

```{r}
data <- read_csv("D:/Downloads/medication_adherence.editted4.csv")
```

```{r}
colnames(data)
```


```{r}
library(dplyr)

data %>%
  summarise(across(everything(), ~ list(
    Frequency = table(.),
    Percentage = prop.table(table(.)) * 100
  )))

```


```{r}
library(dplyr)
library(gtsummary)

# Convert character variables to factor (important for gtsummary)
data_factor <- data %>%
  mutate(across(everything(), as.factor))

# Create descriptive summary table
summary_table <- data_factor %>%
  tbl_summary(
    type = all_categorical() ~ "categorical",
    statistic = all_categorical() ~ "{n} ({p}%)",
    missing = "no"
  )

# Print table nicely
summary_table %>% as_gt()

```


```{r}
library(dplyr)
library(gtsummary)

# Define a function to recode adherence
recode_adherence <- function(x) {
  factor(ifelse(x %in% c("Never", "Once"), "Adherence", "Non-adherence"))
}

# Apply to all variables
data_adherence <- data %>%
  mutate(across(everything(), recode_adherence))

# Create summary table
adherence_table <- data_adherence %>%
  tbl_summary(
    type = all_categorical() ~ "categorical",
    statistic = all_categorical() ~ "{n} ({p}%)",
    missing = "no",
    label = list(
      Miss_Medicines = "Missed Medicines",
      Refuse_Medicines = "Refused Medicines",
      Not_Take_In_Front_Of_Others = "Did not take in front of others",
      Do_Not_Know_Why_Taking = "Did not know why taking",
      Problems_Taking_On_Time = "Problems taking on time"
    )
  ) %>%
  add_overall()  # Optional: adds overall adherence % for each variable

# Print nicely
adherence_table %>% as_gt()

```




```{r}
library(dplyr)

# Recode all 5 variables: "Never" & "Once" â†’ "Adherence", else "Non-adherence"
data_adherence1 <- data %>%
  mutate(across(everything(), ~ factor(ifelse(. %in% c("Never", "Once"), 
                                              "Adherence", "Non-adherence"))))

```







```{r}
data_binary <- data_adherence1 %>%
  rowwise() %>%
  mutate(
    Overall_Adherence = ifelse(sum(c_across(everything()) == "Adherence") >= 4,
                               "Adherence", "Non-adherence")
  ) %>%
  ungroup()

# Summarize
binary_summary <- data_binary %>%
  count(Overall_Adherence) %>%
  mutate(Percentage = round(n / sum(n) * 100, 1))

binary_summary

```


```{r}
library(dplyr)
library(gtsummary)

# Create a gtsummary table for one categorical variable
binary_summary_table <- data_binary %>%
  select(Overall_Adherence) %>%
  tbl_summary(
    missing = "no",                       # Exclude missing
    label = list(Overall_Adherence ~ "Adherence Status"),  # Rename column
    statistic = list(all_categorical() ~ "{n} ({p}%)")     # Count & percentage
  ) %>%
  add_overall() %>%                        # Optional: add overall row
  modify_header(label = "**Adherence Status**")           # Nice header

# Print the table
binary_summary_table



```

