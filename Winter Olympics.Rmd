---
title: "Winter Sports Competition"
author: "Bonsoul"
date: "`r Sys.Date()`"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE, warning = FALSE, message = FALSE, dpi = 180,fig.width = 8, fig.height = 5,echo = TRUE)
```

```{r}
library(tidyverse)
library(knitr)
library(flextable)
library(ggthemes)
library(kableExtra)

#theme_set(theme_plex())
```

```{r, dataset}
tuesdata <- tidytuesdayR::tt_load(2026, week = 6)

schedule <- tuesdata$schedule

```


```{r}
glimpse(schedule)
```

```{r}
percent_nulls <- function(schedule) {
  schedule %>%
    summarise(
      across(
        everything(),
        ~ mean(is.na(.x)) * 100
      )
    ) %>%
    pivot_longer(
      cols = everything(),
      names_to = "variable",
      values_to = "percent_null"
    )
}
```

```{r}
percent_nulls(schedule) %>%
  arrange(desc(percent_null)) %>%
  mutate(
    percent_null = round(percent_null, 2)  
  ) %>%
  kable(
    col.names = c("Variable", "Percent Missing"),
    caption = "Percentage of Missing Values by Variable"
  ) %>%
  kable_styling(
    bootstrap_options = c("striped", "hover", "condensed"),
    full_width = FALSE,
    position = "center"
  )

```


```{r}
schedule %>%
  count(discipline_name, sort = TRUE)

```

```{r,Top 10 Disciplines by Number of Scheduled Events}
schedule %>%
  count(discipline_name) %>%
  slice_max(n, n = 10) %>%
  ggplot(aes(x = n, y = reorder(discipline_name, n))) +
  geom_col() +
  labs(
    title = "Top 10 Disciplines by Number of Scheduled Events",
    x = "Number of Events",
    y = NULL
  )

```


```{r}
medals <- schedule %>%
  filter(is_medal_event) %>%
  count(date)
```

```{r}
ggplot(medals, aes(x = date, y = n)) +
  geom_col() +
  labs(
    title = "Medal Events by Day",
    x = "Date",
    y = "Number of Medal Events"
  )


```

#What is the typical duration of different types of events?

```{r,different types of events}
duration <- schedule %>%
  mutate(
    duration_minutes = as.numeric(
      difftime(end_datetime_local, start_datetime_local, units = "mins")
    ),
    event_type = case_when(
      is_training ~ "Training",
      is_medal_event ~ "Medal",
      TRUE ~ "Competition"
    )
  )

```

```{r}
duration %>%
  group_by(event_type) %>%
  summarise(
    median_duration = median(duration_minutes),
    mean_duration   = mean(duration_minutes),
    n_events        = n()
  )

```

```{r}
ggplot(duration, aes(x = event_type, y = duration_minutes)) +
  geom_boxplot() +
  labs(
    title = "Event Duration by Event Type",
    x = NULL,
    y = "Duration (minutes)"
  )

```

```{r}
schedule %>%
  count(venue_name, sort = TRUE)

```

```{r}
schedule %>%
  count(venue_name) %>%
  slice_max(n, n = 10) %>%
  ggplot(aes(x = n, y = reorder(venue_name, n))) +
  geom_col() +
  labs(
    title = "Venues Hosting the Most Events",
    x = "Number of Events",
    y = NULL
  )

```

```{r}

schedule %>%
  count(venue_name, is_training) %>%
  group_by(venue_name) %>%
  mutate(total_events = sum(n)) %>%
  ungroup() %>%
  slice_max(total_events, n = 10) %>%
  mutate(
    is_training = if_else(is_training, "Training", "Competition"),
    venue_name = reorder(venue_name, total_events)
  ) %>%
  ggplot(aes(x = venue_name, y = n, fill = is_training)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Training vs Competition Sessions by Venue (Top 10)",
    x = NULL,
    y = "Number of Sessions",
    fill = "Session Type"
  )


```

#How does the schedule vary by day of the week?

```{r}
schedule <- schedule %>%
  mutate(
    day_of_week = factor(
      day_of_week,
      levels = c("Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday")
    )
  )

```

```{r}
schedule %>% count(day_of_week)
```

```{r}
schedule %>%
  count(day_of_week) %>%
  ggplot(aes(x = day_of_week, y = n)) +
  geom_col() +
  labs(
    title = "Events by Day of the Week",
    x = NULL,
    y = "Number of Events"
  )

```

```{r}
schedule %>%
  mutate(
    session_type = if_else(is_training, "Training", "Competition")
  ) %>%
  count(session_type) %>%
  mutate(prop = n/sum(n)) %>%
  flextable()

```

#What proportion of scheduled sessions are training versus competition?

```{r}
schedule %>%
  mutate(session_type = if_else(is_training, "Training", "Competition")) %>%
  count(session_type) %>%
  ggplot(aes(x = session_type, y = n)) +
  geom_col() +
  labs(
    title = "Training vs Competition Sessions",
    x = NULL,
    y = "Number of Sessions"
  )


```

