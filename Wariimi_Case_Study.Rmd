---
title: "Wariimi Caase Study"
author: "Bonsoul"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
```

```{r}
df1 <- read_csv("D:/Downloads/10-17 YRS_ PREVALENCE OF DEPRESSION AND POST TRAUMATIC STRESS DISORDER AMONG ADOLESCENTS WITH HIV_AIDS ATTENDING COMPREHENSIVE CARE CLINICS IN HOSPITALS IN RUIRU SUB COUNTY (Responses) - Form Responses 1.csv")
```

```{r}
df2 <- read_csv("D:/Downloads/18-19 YRS_ PREVALENCE OF DEPRESSION AND POST TRAUMATIC STRESS DISORDER AMONG ADOLESCENTS WITH HIV_AIDS ATTENDING COMPREHENSIVE CARE CLINICS IN HOSPITALS IN RUIRU SUB COUNTY (Responses) - Form Responses 1.csv")

```

```{r}
colnames(df2)
```


```{r}
dim(df2)
dim(df1)

```


```{r}
colnames(df1)

```

```{r}
library(skimr)

skim(df1)
```

```{r}
library(dplyr)
library(janitor)
library(psych)   # for describe()

```



```{r,Clean column names}
df1c <- df1 %>% janitor::clean_names()
df2c <- df2 %>% janitor::clean_names()
```

```{r}
missing_in_df2 <- setdiff(names(df1c), names(df2c))
missing_in_df1 <- setdiff(names(df2c), names(df1c))
```

```{r}
df2c[missing_in_df2] <- NA
df1c[missing_in_df1] <- NA

```

```{r}
df2c <- df2c[, names(df1c)]
```

```{r}
merged_df <- bind_rows(df1c, df2c)

df <- merged_df
```

```{r}
df10 <- df    #copying the dataframe
```


```{r}
library(dplyr)
library(tidyr)
library(janitor)

df <- df %>%
  # split multiple responses into separate rows
  separate_rows(who_do_you_currently_live_with_select_all_that_apply, sep = ",") %>%
  mutate(
    # trim whitespace
    who_do_you_currently_live_with_select_all_that_apply = trimws(who_do_you_currently_live_with_select_all_that_apply),
    # recode into clean categories
    currently_live1 = case_when(
      grepl("Alone", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "Alone",
      grepl("Mom|mother", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "Mother",
      grepl("Dad|father", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "Father",
      grepl("Siblings", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "Siblings",
      grepl("Grandparents", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "Grandparents",
      grepl("Relative|Auntie", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "Relatives",
      grepl("Househelp|Shamba boy", who_do_you_currently_live_with_select_all_that_apply, ignore.case = TRUE) ~ "House help and shamba boy",
      TRUE ~ "Other"
    )
  )

# Create frequency table with percentages
live_with_freq <- tabyl(df, currently_live1) %>%
  adorn_pct_formatting()

# Print
print(live_with_freq)

```

```{r}
tabyl(df, currently_live1) %>% 
  adorn_pct_formatting()
```



```{r}
tabyl(df, currently_live) %>% 
  adorn_pct_formatting()
```

```{r}
library(dplyr)
library(janitor)

df <- df %>%
  mutate(
    residence_case = case_when(
      grepl("^a\\) Home$", trimws(where_do_you_live)) ~ "Home",
      grepl("^b\\) Orphanage/ Children's Home$", trimws(where_do_you_live)) ~ "Orphanage/ Children's Home",
      grepl("Relative's place", trimws(where_do_you_live)) ~ "Relative's place",
      grepl("Living with Auntie after the death of the mother in April", trimws(where_do_you_live)) ~ "Relative's place",
      TRUE ~ where_do_you_live   # keep any other text as-is
    )
  )

# Check frequencies
tabyl(df, residence_case) %>% 
  adorn_pct_formatting()


```



```{r}
library(dplyr)
library(janitor)
# Recode school status
df <- df %>%
  mutate(
    school_status = case_when(
      grepl("Yes|currently", are_you_currently_in_school, ignore.case = TRUE) ~ "Yes",
      grepl("No|finished", are_you_currently_in_school, ignore.case = TRUE) ~ "No",
      TRUE ~ NA_character_
    )
  )


```



```{r}
tabyl(df, what_is_your_sex) %>% 
  adorn_pct_formatting()

```

```{r}
tabyl(df, what_is_the_highest_level_of_education_that_you_have_attained) %>% 
  adorn_pct_formatting()

```

```{r}
tabyl(df, are_you_currently_in_school) %>% 
  adorn_pct_formatting()

```


```{r}
# Check frequencies
tabyl(df, who_lives_with) %>%
  adorn_pct_formatting()

```

```{r}
tabyl(df, is_there_anyone_new_at_home) %>% 
  adorn_pct_formatting()

```

```{r}
tabyl(df, has_someone_left_in_the_last_1_year) %>% 
  adorn_pct_formatting()

```

```{r}
tabyl(df, are_you_currently_involved_in_any_work_for_pay) %>% 
  adorn_pct_formatting()

```

```{r}
library(gtsummary)
```


```{r}
table1 <- df %>%
  select(
    what_is_your_sex,
    currently_live1,
    residence_case,
    are_you_currently_in_school,
    what_is_the_highest_level_of_education_that_you_have_attained,
    are_you_currently_involved_in_any_work_for_pay,
    is_there_anyone_new_at_home,
    has_someone_left_in_the_last_1_year
  ) %>%
  tbl_summary(
    statistic = all_categorical() ~ "{n} ({p}%)"
  )

table1

```


#TABLE 2: PSYCHOLOGICAL RESOURCES, VULNERABILITIES & RISK BEHAVIOR


```{r}
df10_clean <- df10 %>%
  separate_rows(to_whom_can_you_talk_at_home_when_you_have_a_problem, sep = ",") %>%
  mutate(to_whom = trimws(tolower(to_whom_can_you_talk_at_home_when_you_have_a_problem)),
         to_whom = case_when(
           to_whom %in% c("a) parents", "parents", "mother", "father") ~ "Parents",
           to_whom %in% c("b) siblings", "siblings", "sibling") ~ "Siblings",
           to_whom %in% c("c) relatives", "relatives", "auntie", "aunt", "uncle") ~ "Relatives",
           to_whom %in% c("friend", "friend at home") ~ "Friend",
           to_whom %in% c("bestfriend", "best friend") ~ "Best friend",
           to_whom %in% c("none", "no one", "no one in specific") ~ "None",
           TRUE ~ stringr::str_to_title(to_whom) # keep others but clean them
         ))

df10_clean %>%
  count(to_whom) %>%
  mutate(percent = round(n / nrow(df10) * 100, 1))

```



```{r}
tabyl(df10, who_do_you_talk_to_when_you_have_a_problem) %>% 
  adorn_pct_formatting()

```

```{r}
tabyl(df, are_there_times_when_you_miss_meals) %>% 
  adorn_pct_formatting()

```

```{r}
tabyl(df, do_you_go_to_school_hungry) %>% 
  adorn_pct_formatting()

```






